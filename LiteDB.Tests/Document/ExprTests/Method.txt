# BsonExpression Unit Test

# String functions
> "Lite" + "DB" + "v" + 5
= "LiteDBv5"
> upper("liteDB")
= "LITEDB"
> LOWER("LiteDB")
= "litedb"
> UPPER("LiteDB" + "-ok")
= "LITEDB-OK"
> UPPER("LiteDB") + "-ok"
= "LITEDB-ok"
> UPPER(3)
= null
> SUBSTRING("LiteDB", 0, 2)
= "Li"
> LOWER(SUBSTRING("LiteDB", 4))
= "db"
> LPAD(27, 5, "0")
= "00027"
> RPAD(27, 5, "0")
= "27000"
> REPLACE("Hi", "i", "I")
= "HI"
> REPLACE(ITEMS(["Lite", "LiteDB"]), "L", "x")
= "xite"
= "xiteDB"

# String in array items
{ arr: ["one", "two"] }
> UPPER(arr[*])
= "ONE"
= "TWO"
> SUBSTRING(arr[*], 0, 1)
= "o"
= "t"

# JSON Parser
> JSON('{a:1, b:"string"}')
= { a: 1, b: "string" }
> JSON('"string-only"')
= "string-only"
> JSON('error')
= null

# EXTEND document
{a:1}
> EXTEND($, {b:2})
= {a:1, b:2}
> EXTEND($, {a:2})
= {a:2}
> EXTEND($, {a:2, b:{c:2}})
= {a: 2, b: {c: 2} }
> EXTEND({a:true}, {a: false})
= {a:false}

# DATE functions
{d:{$date: "2018-05-01T15:30:45Z"}}
> YEAR(d)
= 2018
> MONTH(d)
= 5
> DAY(d)
= 1

# dateParts: "y|year", "M|month", "d|day", "h|hour", "m|minute", "s|second"

> DATEADD('d', 1, d)
= {$date: "2018-05-02T15:30:45Z"}
> DATEADD('d', -1, d)
= {$date: "2018-04-30T15:30:45Z"}
> DATEADD('M', 12, d)
= {$date: "2019-05-01T15:30:45Z"}

> DATEDIFF('M', d, DATE_UTC(2018, 6, 1))
= 1
> DATEDIFF('M', d, DATE_UTC(2018, 4, 1))
= -1

# Length Method
{a:'my string', empty: '', rnull: null, b: {$binary:'MTIz'}, arr: [1, 2, null]}
> LENGTH(a)
= 9
> LENGTH(empty)
= 0
> LENGTH(rnull)
= null
> LENGTH(miss)
= null
> LENGTH(b)
= 3
> LENGTH(arr)
= 3
> LENGTH($)
= 5

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Queries - Hugo Whisper Theme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="www.example.com/favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  
  
  
  <link rel="stylesheet" href="/www.example.com/css/style.min.f31edf12f81d9ad5234f2b100646ce1f51e3ab0f6a37c940a43bcd79513204c3.css">
  

  

</head>

<body class='page page-default-single'>

  <div class="github-fork-ribbon-wrapper right">
      <div class="github-fork-ribbon">
          <a href="https://github.com/mbdavid/litedb">Fork me on GitHub</a>
      </div>
  </div>

  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="www.example.com/">
        <span>HOME</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="www.example.com/docs/">
        <span>DOCS</span>
      </a>
    </li>
    
    <li class="menu-item-api">
      <a href="www.example.com/api/">
        <span>API</span>
      </a>
    </li>
    
    <li class="menu-item-download">
      <a href="https://www.nuget.org/packages/LiteDB/">
        <span>DOWNLOAD</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="www.example.com"><img alt="Logo" src="/www.example.com/logo_litedb.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="www.example.com"><img alt="Logo" src="/www.example.com/logo_litedb.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="www.example.com/">
        <span>HOME</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="www.example.com/docs/">
        <span>DOCS</span>
      </a>
    </li>
    
    <li class="menu-item-api">
      <a href="www.example.com/api/">
        <span>API</span>
      </a>
    </li>
    
    <li class="menu-item-download">
      <a href="https://www.nuget.org/packages/LiteDB/">
        <span>DOWNLOAD</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <h4>Docs</h4>
  <ul>
    
    <li class="">
      <a href="www.example.com/docs/bsondocument/">BsonDocument</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/changelog/">ChangeLog</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/collections/">Collections</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/concurrency/">Concurrency</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/connection-string/">Connection String</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/data-structure/">Data Structure</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/dbref/">DbRef</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/expressions/">Expressions</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/filestorage/">FileStorage</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/getting-started/">Getting Started</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/how-litedb-works/">How LiteDB Works</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/indexes/">Indexes</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/object-mapping/">Object Mapping</a>
    </li>
    
    <li class="active ">
      <a href="www.example.com/docs/queries/">Queries</a>
    </li>
    
    <li class="">
      <a href="www.example.com/docs/repository-pattern/">Repository Pattern</a>
    </li>
    
  </ul>
</div>

          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Queries</h1>
<div class="content">
  

<p>Query filter document inside a collection in three ways:</p>

<ul>
<li>Indexed based search (best option). See <a href="Indexes">Indexes</a></li>
<li>Full scan on BsonDocument (slower but more powerful)</li>
<li>LINQ to object (slower but convenient)</li>
</ul>

<h3 id="query-implementations">Query implementations</h3>

<p><code>Query</code> is a static class that creates a query criteria. Each method represents a different criteria operation that can be used to query documents.</p>

<ul>
<li><strong><code>Query.All</code></strong> - Returns all documents. Can be specified an index field to read in ascending or descending index order.</li>
<li><strong><code>Query.EQ</code></strong> - Find document are equals (==) to value.</li>
<li><strong><code>Query.LT/LTE</code></strong> - Find documents less then (&lt;) or less then equals (&lt;=) to value.</li>
<li><strong><code>Query.GT/GTE</code></strong> - Find documents greater then (&gt;) or greater then equals (&gt;=) to value.</li>
<li><strong><code>Query.Between</code></strong> - Find documents between start/end value.</li>
<li><strong><code>Query.In</code></strong> - Find documents that are equals of listed values.</li>
<li><strong><code>Query.Not</code></strong> - Find documents that are NOT equals (!=) to value.</li>
<li><strong><code>Query.StartsWith</code></strong> - Find documents that strings starts with value. Valid only for string data type.</li>
<li><strong><code>Query.Contains</code></strong> - Find documents that strings contains value. Valid only for string data type. This query do index search, only index scan (slow for many documents).</li>
<li><strong><code>Query.Where</code></strong> - Find documents based in a <code>Func&lt;BsonValue, bool&gt;</code> predicate, where <code>BsonValue</code> are each key in index. It&rsquo;s a full index scan based query.</li>
<li><strong><code>Query.And</code></strong> - Apply intersection between two queries results.</li>
<li><strong><code>Query.Or</code></strong> - Apply union between two queries results.</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-C#" data-lang="C#"><span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">EQ</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">,</span> <span class="s">&#34;John Doe&#34;</span><span class="p">));</span>

<span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">GTE</span><span class="p">(</span><span class="s">&#34;Age&#34;</span><span class="p">,</span> <span class="m">25</span><span class="p">));</span>

<span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">And</span><span class="p">(</span>
    <span class="n">Query</span><span class="p">.</span><span class="n">EQ</span><span class="p">(</span><span class="s">&#34;FirstName&#34;</span><span class="p">,</span> <span class="s">&#34;John&#34;</span><span class="p">),</span> <span class="n">Query</span><span class="p">.</span><span class="n">EQ</span><span class="p">(</span><span class="s">&#34;LastName&#34;</span><span class="p">,</span> <span class="s">&#34;Doe&#34;</span><span class="p">)</span>
<span class="p">));</span>

<span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">,</span> <span class="s">&#34;Jo&#34;</span><span class="p">));</span>

<span class="c1">// Query using multikey index (where products are an array of embedded documents)
</span><span class="c1"></span><span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">GT</span><span class="p">(</span><span class="s">&#34;Products[*].Price&#34;</span><span class="p">,</span> <span class="m">100</span><span class="p">))</span>

<span class="c1">// Execute Func in each key in Name index
</span><span class="c1"></span><span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=&gt;</span> <span class="n">name</span><span class="p">.</span><span class="n">AsString</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">20</span><span class="p">));</span>

<span class="c1">// get last added 100 objects of the collection
</span><span class="c1"></span><span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">collection</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">All</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">Descending</span><span class="p">),</span> <span class="n">limit</span><span class="p">:</span> <span class="m">100</span><span class="p">);</span>

<span class="c1">// find top 100 oldest persons aged between 20 and 30
</span><span class="c1"></span><span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">And</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">All</span><span class="p">(</span><span class="s">&#34;Age&#34;</span><span class="p">,</span> <span class="n">Query</span><span class="p">.</span><span class="n">Descending</span><span class="p">),</span> <span class="n">Query</span><span class="p">.</span><span class="n">Between</span><span class="p">(</span><span class="s">&#34;Age&#34;</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="m">30</span><span class="p">)),</span> <span class="n">limit</span><span class="p">:</span> <span class="m">100</span><span class="p">);</span>
</code></pre></div>
<p>In all queries:</p>

<ul>
<li>In index search, <strong>Field</strong> must be an index name or field in document.</li>
<li>When no index using, <strong>Field</strong> can be <code>Path</code> or an <code>Expression</code></li>
<li><strong>Field</strong> name on left side, <strong>Value</strong> (or values) on right side</li>
<li>Queries are executed in <code>BsonDocument</code> class before mapping to your object. You need to use the <code>BsonDocument</code> field name and BSON types values. If you are using a custom <code>ResolvePropertyName</code> or <code>[BsonField]</code> attribute, you must use your document field name and not the property name on your type. See <a href="Object-Mapping">Object Mapping</a>.</li>
</ul>

<h3 id="find-findbyid-findone-and-findall">Find(), FindById(), FindOne() and FindAll()</h3>

<p>Collections are 4 ways to return documents:</p>

<ul>
<li><strong><code>FindAll</code></strong>: Returns all documents on collection</li>
<li><strong><code>FindOne</code></strong>: Returns <code>FirstOrDefault</code> result of <code>Find()</code></li>
<li><strong><code>FindById</code></strong>: Returns <code>SingleOrDefault</code> result of <code>Find()</code> by using primary key <code>_id</code> index.</li>
<li><strong><code>Find</code></strong>: Return documents using <code>Query</code> builder or LINQ expression on collection.</li>
</ul>

<p><code>Find()</code> supports <code>Skip</code> and <code>Limit</code> parameters. These operations are used at the index level, so it&rsquo;s more efficient than in LINQ to Objects.</p>

<p><code>Find()</code> method returns an <code>IEnumerable</code> of documents. If you want do more complex filters, value as expressions, sorting or transforms results you can use LINQ to Objects.</p>

<p>Returning an <code>IEnumerable</code> your code still connected to datafile. Only when you finish consume all data, datafile will be disconected.</p>
<div class="highlight"><pre class="chroma"><code class="language-C#" data-lang="C#"><span class="n">col</span><span class="p">.</span><span class="n">EnsureIndex</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">col</span>
    <span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">EQ</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">,</span> <span class="s">&#34;John Doe&#34;</span><span class="p">))</span> <span class="c1">// This filter is executed in LiteDB using index
</span><span class="c1"></span>    <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CreationDate</span> <span class="p">&gt;=</span> <span class="n">x</span><span class="p">.</span><span class="n">DueDate</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(-</span><span class="m">5</span><span class="p">))</span> <span class="c1">// This filter is executed by LINQ to Object
</span><span class="c1"></span>    <span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> 
    <span class="p">{</span> 
        <span class="n">FullName</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">FirstName</span> <span class="p">+</span> <span class="s">&#34; &#34;</span> <span class="p">+</span> <span class="n">x</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span> 
        <span class="n">DueDays</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">DueDate</span> <span class="p">-</span> <span class="n">x</span><span class="p">.</span><span class="n">CreationDate</span> 
    <span class="p">});</span> <span class="c1">// Transform
</span></code></pre></div>
<h3 id="count-and-exists">Count() and Exists()</h3>

<p>These two methods are useful because you can count documents (or check if a document exists) without deserializing the document.</p>
<div class="highlight"><pre class="chroma"><code class="language-C#" data-lang="C#"><span class="c1">// This way is more efficient
</span><span class="c1"></span><span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="n">collection</span><span class="p">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">EQ</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">,</span> <span class="s">&#34;John Doe&#34;</span><span class="p">));</span>

<span class="c1">// Than use Find + Count
</span><span class="c1"></span><span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="n">collection</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">Query</span><span class="p">.</span><span class="n">EQ</span><span class="p">(</span><span class="s">&#34;Name&#34;</span><span class="p">,</span> <span class="s">&#34;John Doe&#34;</span><span class="p">)).</span><span class="n">Count</span><span class="p">();</span>
</code></pre></div>
<ul>
<li>In the first count, LiteDB uses the index to search and count the number of index occurrences of &ldquo;Name = John&rdquo; without deserializing and mapping the document.</li>
<li>If the <code>Name</code> field does not have an index, LiteDB will deserialize the document but will not run the mapper. Still faster than <code>Find().Count()</code></li>
<li>The same idea applies when using <code>Exists()</code>, which is again better than using <code>Count() &gt;= 1</code>. Count needs to visit all matched results and <code>Exists()</code> stops on first match (similar to LINQ&rsquo;s <code>Any</code> extension method).</li>
</ul>

<h3 id="min-and-max">Min() and Max()</h3>

<p>LiteDB uses a skip list implementation for indexes (See <a href="Indexes">Indexes</a>). Collections offer <code>Min</code> and <code>Max</code> index values. The implementation is:</p>

<ul>
<li><strong><code>Min</code></strong> - Read head index node (MinValue BSON data type) and move to next node. This node is the lowest value in index. If index are empty, returns MinValue. Lowest value is not the first value!</li>
<li><strong><code>Max</code></strong> - Read tail index node (MaxValue BSON data type) and move to previous node. This node is the highest value on index. If index are empty, returns MaxValue. Highest value is not the last value!</li>
</ul>

<p>Min/Max required a created index in field.</p>

<h3 id="linq-expressions">LINQ expressions</h3>

<p>Some LiteDB methods support predicates to allow you to easily query strongly typed documents.  If you are working with <code>BsonDocument</code>, you need to use classic <code>Query</code> class methods.</p>
<div class="highlight"><pre class="chroma"><code class="language-C#" data-lang="C#"><span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&#34;John Doe&#34;</span><span class="p">)</span>
<span class="c1">// Query.EQ(&#34;Name&#34;, &#34;John Doe&#34;)
</span><span class="c1"></span>
<span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&gt;</span> <span class="m">30</span><span class="p">)</span>
<span class="c1">// Query.GT(&#34;Age&#34;, 30)
</span><span class="c1"></span>
<span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&#34;John&#34;</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&gt;</span> <span class="m">30</span><span class="p">)</span>
<span class="c1">// Query.And(Query.StartsWith(&#34;Name&#34;, &#34;John&#34;), Query.GT(&#34;Age&#34;, 30))
</span><span class="c1"></span>
<span class="c1">// where PhoneNumbers is string[]
</span><span class="c1"></span><span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">PhoneNumbers</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;555-1234&#34;</span><span class="p">))</span>
<span class="c1">// Query.EQ(&#34;PhoneNumbers&#34;, &#34;555-1234&#34;)
</span><span class="c1"></span>
<span class="c1">// create index on Number inside phone array
</span><span class="c1"></span><span class="n">col</span><span class="p">.</span><span class="n">EnsureIndex</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Phones</span><span class="na">[0]</span><span class="p">.</span><span class="n">Number</span><span class="p">);</span> <span class="c1">// ignore 0 index: it&#39;s just a syntax to access child
</span><span class="c1">// db.EnsureIndex(&#34;col&#34;, &#34;Phones[*].Number&#34;, false, &#34;$.Phones[*].Number)
</span><span class="c1"></span>
<span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Phones</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">z</span> <span class="p">=&gt;</span> <span class="n">z</span><span class="p">.</span><span class="n">Number</span> <span class="p">==</span> <span class="s">&#34;555-1234&#34;</span><span class="p">))</span> <span class="c1">// another way to access child
</span><span class="c1">// Query.EQ(&#34;Phones[*].Numbers&#34;, &#34;555-1234&#34;)
</span><span class="c1"></span>
<span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="p">!(</span><span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&gt;</span> <span class="m">30</span><span class="p">))</span>
<span class="c1">// Query.Not(Query.GT(&#34;Age&#34;, 30))
</span></code></pre></div>
<ul>
<li>LINQ implementations are: <code>==, !=, &gt;, &gt;=, &lt;, &lt;=, StartsWith, Contains (string and IEnumerable), Equals, &amp;&amp;, ||, ! (not)</code></li>
<li>Property name support inner document field: <code>x =&gt; x.Name.Last == &quot;Doe&quot;</code></li>
<li>Behind the scene, LINQ expressions are converted to <code>Query</code> implementations using <code>QueryVisitor</code> class.</li>
</ul>

</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/www.example.com/js/scripts.min.bf1e1f7ae8e03db5f012356e825843facdff51c0a559cb0d27fe2bbe1db405c2.js"></script>
  

  
  
  
    
  


</body>

</html>
